# Introduction {#intro}

Samba version 4.14 and newer ships with Linux client Group Policy. The Group Policy offerings are made to be similar to what is offered by proprietary tools, such as Vintela’s and Centrify’s Group Policy.

Group Policy provides centralized management and configuration of operating system, application, and user settings. Policies are delivered to clients by listing them in LDAP, under groupPolicyContainer objects. These objects provide the gPCFileSysPath attribute, which points to policy information stored on the domains SYSVOL share.

## What's the difference between Group Policy and a Group Policy Object?

A Group Policy Object (GPO) is a collection of settings that apply to a set of machines or users in a group. You can think of *Group Policy* like a template for a work order, and a *Group Policy Object* like a filled out copy of that template. A GPO is a *work order* of instructions to follow. That work order will be distributed to every member of the group, and it's up to each member to decide how it *applies* those instructions.

A GPO is modified by a *Server Side Extension*, and it is *applied* for a group member by a *Client Side Extension*.

## Server Side Extensions

The purpose of a Server Side Extension (SSE) is to fill out a *work order* (a Group Policy Object). On Windows, this generally refers to some component of the Group Policy Management Editor.

![Group Policy Management Editor](ch01-images/gpme.png)

In Samba, this also includes the `samba-tool gpo manage` command.

```
> samba-tool gpo manage
Usage: samba-tool gpo manage <subcommand>

Manage Group Policy Objects


Options:
  -h, --help  show this help message and exit


Available subcommands:
  access    - Manage Host Access Group Policy Objects
  files     - Manage Files Group Policy Objects
  issue     - Manage Issue Group Policy Objects
  motd      - Manage Message of the Day Group Policy Objects
  openssh   - Manage OpenSSH Group Policy Objects
  scripts   - Manage Scripts Group Policy Objects
  security  - Manage Security Group Policy Objects
  smb_conf  - Manage smb.conf Group Policy Objects
  sudoers   - Manage Sudoers Group Policy Objects
  symlink   - Manage symlink Group Policy Objects
```

When working with Linux clients, using `samba-tool gpo manage` to fill out your GPO is generally the preferred method.

### Enabling Group Policy Server Side Extensions on the Server

In order to use the Samba Administrative Templates in the Group Policy Management Console, you’ll need to install them first, using the command `sudo samba-tool gpo admxload -UAdministrator`.

The samba-tool gpo admxload command copies the Samba ADMX templates to the <domain>/Policies/PolicyDefinitions directory on the SYSVOL share. After installing the Samba ADMX templates, you MUST install Microsoft's ADMX templates also, otherwise you will be unable to administer Windows domain members.

To install Microsoft's ADMX templates, use msiextract to extract the contents of the Administrative Templates msi:

```
msiextract /path/to/microsoft/download/Administrative\ Templates\ \(.admx\)\ for\ Windows\ 10\ October\ 2020\ Update.msi
```

Then upload the contents to the SYSVOL:

```
samba-tool gpo admxload -U Administrator --admx-dir=/path/to/extracted/msi/Program\ Files/Microsoft\ Group\ Policy/Windows\ 10\ October\ 2020\ Update\ \(20H2\)/PolicyDefinitions/
```

## Client Side Extensions

In Group Policy vernacular, a Client Side Extension (CSE) is an encapsulated module on a client machine intended to enforce a specific policy. The responsibility of the CSE is to install that policy on the client and ensure it is enforced. It's also the responsibility of the CSE to remove the policy when disabled by the server.

In Samba, a CSE looks like a single python file. Within that file, the CSE inherits from one of several base classes provided by Samba which provide settings from the server. This is discussed in more detail in chapter \@ref(cse).

### Enabling Group Policy Client Side Extensions on the Linux Client

To enable Group Policy in Winbind, set the apply group policies global smb.conf option to Yes. You can even deploy this setting from Group Policy smb.conf options, then running the apply command manually the first time with `sudo samba-gpupate --force`.

Policies are enforced at a random interval between 90 and 120 seconds.

Policies can be manually enforced at any time on a Linux domain member using the `samba-gpupdate --force` command.

Winbind will enforce both machine policy (as of Samba 4.14) and user policy (as of Samba 4.18).

If the Linux client is joined using SSSD, you can instead enforce the policy using oddjob-gpupdate. The samba-gpupdate command from Samba must also be installed.

## Policies Introduced in this Book

This section will provide a brief overview of the policies that will be discussed in upcoming chapters.

### smb.conf Policies

These policies distribute smb.conf global options to the client. These are found in the Group Policy Management Editor (GPME) under `Computer Configuration > Policies > Administrative Templates > Samba > smb.conf`. This policy is unable to apply idmap policies.

### Password and Kerberos Policies

Password and Kerberos policies are found in the GPME under `Computer Configuration > Policies > OS Settings > Security Settings > Account Policy`. These policies are only applicable to Samba Active Directory Domain Controllers.

### Script Policies

Script policies create cron jobs on client machines which execute the specified commands. These are found in the GPME under `Computer Configuration > Policies > Administrative Templates > Samba > Unix Settings > Scripts`.

#### Centrify Crontab Entries

Samba provides an extension which adds compatibility with Centrify's Crontab Entries Group Policy. If you are currently using Centrify Group Policy to distribute Crontab entry policies, these will automatically be applied by samba-gpupdate.

### Startup Script Policies

Startup script policies allow you to upload the script that will be executed to the SYSVOL, as well as scheduling the command to run at startup. These scripts can be set using the `samba-tool gpo manage scripts startup` command.

### Files Policy

The Files policy deploys files to client machines. These files are uploaded to the SYSVOL via the `samba-tool gpo manage files` command.

### Symlink Policies

The symlink policy creates symbolic links on client machines. This policy is set via the `samba-tool gpo manage symlink` command. This policy is compatible with Vintela's Symlink Group Policy.

### Sudoers Policies

Sudoers policies add sudo rules to client machines. These policies can be managed in the GPME under `Computer Configuration > Policies > Administrative Templates > Samba > Unix Settings > Sudo Rights`.

#### VGP Sudoers Policies

Another Sudoers extension is available for compatibility with Vintela's Sudoers Group Policy. The policy for this extension can be modified using the `samba-tool gpo manage sudo` command.

#### Centrify Sudoers Policies

A third Sudoers extension is available to provide compatibility with Centrify's Sudoers Group Policy. If you are currently using Centrify Group Policy to distribute Sudoers policies, these will automatically be applied by samba-gpupdate.

::: {#info style="color: green;"}
Samba Sudoers, VGP Sudoers, and Centrify Sudoers policies can be safely used in conjunction with one another, since these policies are non-overlapping.
:::

### Message Policies

Message policies set the contents of the /etc/motd and /etc/issue files on client machines. These policies can be managed in the GPME under `Computer Configuration > Policies > Administrative Templates > Samba > Unix Settings > Messages`.

#### VGP Message Policies

Other VGP Message extensions are available for compatibility with Vintela's MOTD and Issue Group Policies. The policies for these extensions can be modified using the `samba-tool gpo manage motd` and `samba-tool gpo manage issue` commands.

::: {#warn style="color: red;"}
Beware that applying both the Samba and VGP message policies will cause unpredictable behavior, since both policies will apply and will overwrite one another.
:::

### PAM Access Policies

PAM Access policies set access rules within `/etc/security/access.d`. These policies are set using the `samba-tool gpo manage access` command. This policy is compatible with Vintela's Access Group Policy.

### Certificate Auto Enrollment

Certificate Auto Enrollment allows devices to enroll for certificates from Active Directory Certificate Services. Certificate Auto Enrollment is available in Samba 4.16 and above.

### Firefox Policy

Firefox policies can be administered using the Mozilla policy templates provided by Mozilla.

### Chromium/Chrome Policy

Chromium and Google Chrome policies can be administered using the Chrome policy templates provided by Google.

### GNOME Settings

GNOME Settings policies are found in the GPME under `Computer Configuration > Policies > Administrative Templates > Samba > GNOME`. These policies manage some GNOME user settings, as described in the GNOME system admin guide, such as the compose key, screen dimming, online account management, extensions, and the ability to disable printing, file saving, command line access, fingerprint logon, logout, user switching, and reparitioning. There is also a general method for disabling any specific GNOME lockdown value.

### OpenSSH Policy

OpenSSH policy applies settings to /etc/ssh/sshd_config.d. These policies can be set using the `samba-tool gpo manage openssh` command. These policies are compatible with Vintela's OpenSSH Group Policy.

### Firewalld Policy

Firewalld policy applies firewall rules using the firewall-cmd command. These policies can be found in the GPME under `Computer Configuration > Policies > Administrative Templates > Samba > Unix Settings > Firewalld`.
